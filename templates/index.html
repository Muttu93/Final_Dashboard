<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="sidebar">
        <h2>Sections</h2>
        <ul>
            <li><a href="{{ url_for('dashboard', section='Store') }}">Store</a></li>
            <li><a href="{{ url_for('dashboard', section='Material') }}">Material</a></li>
            <li><a href="{{ url_for('dashboard', section='Employee') }}">Employee</a></li>
        </ul>
    </div>

    <div class="main-content">
        <h1>File Dashboard</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% if current_section %}
            <h2>{{ current_section }} Files</h2>

            <!-- Upload Form -->
            <form action="{{ url_for('upload_file', section=current_section) }}" method="post" enctype="multipart/form-data" class="upload-form">
                <input type="file" name="file" required>
                <button type="submit">Upload File</button>
            </form>

            <!-- Search Form -->
            <form method="GET" action="{{ url_for('dashboard', section=current_section) }}" class="search-form">
                <input type="text" name="query" placeholder="Search files..." value="{{ query or '' }}">
                <button type="submit">Search</button>
            </form>

            {% if files %}
                <table>
                    <thead>
                        <tr>
                            <th>File Name</th>
                            <th>Last Modified</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>{{ file }}</td>
                            <td>{{ file_dates[file] }}</td>
                            <td>
                                <a href="{{ url_for('view_file', section=current_section, filename=file) }}" target="_blank">View</a>
                                <a href="{{ url_for('delete_file', section=current_section, filename=file) }}" onclick="return confirm('Are you sure you want to delete this file?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No files found in this section.</p>
            {% endif %}
        {% else %}
            <p>Please select a section to view files.</p>
        {% endif %}
    </div>
</body>
</html>
